FCP           = mpxlf95_r
FCS           = xlf95_r
FFLAGS        = -qfree=f90 -qsuffix=f=f90:cpp=F90 -WF,-Dibm_sp -lessl_r -lmass -lmpitrace -O3 -qsmp=noauto -qarch=pwr6 -qmaxmem=-1 \
                -qhot -qfullpath -qstrict -bloadmap:loadmap.txt -bdatapsize:64K -bstackpsize:64K
FFLAGS2       = -lessl_r -lmass -O3 -qsmp=noauto -qarch=pwr6 -qmaxmem=-1 -qfullpath -qdbg -qstrict
FFLAGS3       = -qfree=f90 -qsuffix=f=f90:cpp=F90 -qarch=auto -O3 -qmaxmem=-1 -qfullpath -qdbg -qstrict -q64 -qsmp=noauto
COREINC       = /nwprod/lib/incmod
INCsigio      = $(COREINC)/sigio_4
INCsfcio      = $(COREINC)/sfcio_4
LIBncep       = /nwprod/lib


.SUFFIXES: .o .f90 .F90

all: getsigensmean getsigensmean_smooth getsfcensmean adderrspec_spec recentersigp getsigensspread

OBJS_GETSIGENSMEAN=kinds.o specmod.o
OBJS_GRDTOSPEC=kinds.o specmod.o rnorm.o constants.o

getsigensmean: $(OBJS_GETSIGENSMEAN)
	$(FCS) -I $(INCsigio) $(FFLAGS2) -o getsigensmean.x getsigensmean.f -L$(LIBncep) -lsp_4 -lsigio_4

getsigensmean_smooth: $(OBJS_GETSIGENSMEAN)
	$(FCS) $(FFLAGS2) -I  $(INCsigio) -o getsigensmean_smooth.x getsigensmean_smooth_ncep.f90 -L$(LIBncep) -lsigio_4 -lsp_4 -lessl_r

getsfcensmean:
	$(FCS) -I $(INCsfcio) $(FFLAGS2) -o getsfcensmean.x getsfcensmean.f -L$(LIBncep) -lsfcio_4

adderrspec_spec:
	$(FCP) $(FFLAGS3) -I $(INCsigio) -o adderrspec_nmcmeth_spec.x adderrspec_nmcmeth_ncep_spec.f90 -L$(LIBncep) -lsigio_4 -lsp_4 -lmpitrace

recentersigp: $(OBJS_GETSIGENSMEAN)
	$(FCP) -I $(INCsigio) $(FFLAGS2) -o recentersigp.x recentersigp.f $(OBJS_GETSIGENSMEAN) -L$(LIBncep) -lsp_4 -lsigio_4

getsigensspread: $(OBJS_GETSIGENSMEAN)
	$(FCP) -I $(INCsigio) $(FFLAGS2) -o getsigensspread.x getsigensspread.f90 $(OBJS_GETSIGENSMEAN) -L$(LIBncep) -lsp_4 -lbacio_4 -lsigio_4


clean:
	rm -f $(OBJS_GETSIGENSMEAN) $(OBJS_GRDTOSPEC) *.mod *.x *.o $(EXEC) loadmap.txt

.F90.o:
	$(FCP) $(FFLAGS) -c $<

.f90.o:
	$(FCP) $(FFLAGS) -c $< 

.f.o:
	$(FCP) $(FFLAGS) -free -c $< 

%.o : %.mod

kinds.o:	kinds.f90

constants.o:	constants.f90 kinds.o

specmod.o:	specmod.f90 kinds.o

rnorm.o:	rnorm.f90 kinds.o

